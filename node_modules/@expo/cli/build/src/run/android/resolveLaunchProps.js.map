{"version":3,"sources":["../../../../src/run/android/resolveLaunchProps.ts"],"sourcesContent":["import { AndroidConfig } from '@expo/config-plugins';\n\nimport { AndroidAppIdResolver } from '../../start/platforms/android/AndroidAppIdResolver';\nimport { CommandError } from '../../utils/errors';\n\nexport interface LaunchProps {\n  /**\n   * The \"common\" Android package name, configured through the app manifest.\n   * @see https://source.android.com/docs/core/architecture/hidl/code-style#package-names\n   */\n  packageName: string;\n  /**\n   * Optional customized application ID, used in product flavors.\n   * @see https://developer.android.com/build/build-variants#change-app-id\n   */\n  customAppId?: string;\n  /**\n   * The main activity to launch, by default this is `.MainActivity`.\n   * @see https://github.com/expo/expo/blob/c0aec226a43c0f186258a063a6145c3e52246f8a/templates/expo-template-bare-minimum/android/app/src/main/AndroidManifest.xml#L22\n   */\n  mainActivity: string;\n  /**\n   * The full launch activity reference used in the app intent to launch the app with `adb am start -n <launchActivity>`.\n   * Usually, this is structured as `<package-name>/.<activity-name>`.\n   * For product flavors, this is structured as `<custom-app-id>/<package-name>.<activity-name>`.\n   * @see https://developer.android.com/studio/command-line/adb#IntentSpec\n   */\n  launchActivity: string;\n}\n\nasync function getMainActivityAsync(projectRoot: string): Promise<string> {\n  const filePath = await AndroidConfig.Paths.getAndroidManifestAsync(projectRoot);\n  const androidManifest = await AndroidConfig.Manifest.readAndroidManifestAsync(filePath);\n\n  // Assert MainActivity defined.\n  const activity = await AndroidConfig.Manifest.getRunnableActivity(androidManifest);\n  if (!activity) {\n    throw new CommandError(\n      'ANDROID_MALFORMED',\n      `${filePath} is missing a runnable activity element.`\n    );\n  }\n  // Often this is \".MainActivity\"\n  return activity.$['android:name'];\n}\n\nexport async function resolveLaunchPropsAsync(\n  projectRoot: string,\n  options: { appId?: string }\n): Promise<LaunchProps> {\n  const mainActivity = await getMainActivityAsync(projectRoot);\n  const packageName = await new AndroidAppIdResolver(projectRoot).getAppIdFromNativeAsync();\n  const customAppId = options.appId;\n\n  const launchActivity =\n    customAppId && customAppId !== packageName\n      ? `${customAppId}/${packageName}${mainActivity}`\n      : `${packageName}/${mainActivity}`;\n\n  return {\n    mainActivity,\n    launchActivity,\n    packageName,\n    customAppId,\n  };\n}\n"],"names":["resolveLaunchPropsAsync","getMainActivityAsync","projectRoot","filePath","AndroidConfig","Paths","getAndroidManifestAsync","androidManifest","Manifest","readAndroidManifestAsync","activity","getRunnableActivity","CommandError","$","options","mainActivity","packageName","AndroidAppIdResolver","getAppIdFromNativeAsync","customAppId","appId","launchActivity"],"mappings":"AAAA;;;;+BA8CsBA,yBAAuB;;aAAvBA,uBAAuB;;;yBA9Cf,sBAAsB;;;;;;sCAEf,oDAAoD;wBAC5D,oBAAoB;AA2BjD,eAAeC,oBAAoB,CAACC,WAAmB,EAAmB;IACxE,MAAMC,QAAQ,GAAG,MAAMC,cAAa,EAAA,cAAA,CAACC,KAAK,CAACC,uBAAuB,CAACJ,WAAW,CAAC,AAAC;IAChF,MAAMK,eAAe,GAAG,MAAMH,cAAa,EAAA,cAAA,CAACI,QAAQ,CAACC,wBAAwB,CAACN,QAAQ,CAAC,AAAC;IAExF,+BAA+B;IAC/B,MAAMO,QAAQ,GAAG,MAAMN,cAAa,EAAA,cAAA,CAACI,QAAQ,CAACG,mBAAmB,CAACJ,eAAe,CAAC,AAAC;IACnF,IAAI,CAACG,QAAQ,EAAE;QACb,MAAM,IAAIE,OAAY,aAAA,CACpB,mBAAmB,EACnB,CAAC,EAAET,QAAQ,CAAC,wCAAwC,CAAC,CACtD,CAAC;IACJ,CAAC;IACD,gCAAgC;IAChC,OAAOO,QAAQ,CAACG,CAAC,CAAC,cAAc,CAAC,CAAC;AACpC,CAAC;AAEM,eAAeb,uBAAuB,CAC3CE,WAAmB,EACnBY,OAA2B,EACL;IACtB,MAAMC,YAAY,GAAG,MAAMd,oBAAoB,CAACC,WAAW,CAAC,AAAC;IAC7D,MAAMc,WAAW,GAAG,MAAM,IAAIC,qBAAoB,qBAAA,CAACf,WAAW,CAAC,CAACgB,uBAAuB,EAAE,AAAC;IAC1F,MAAMC,WAAW,GAAGL,OAAO,CAACM,KAAK,AAAC;IAElC,MAAMC,cAAc,GAClBF,WAAW,IAAIA,WAAW,KAAKH,WAAW,GACtC,CAAC,EAAEG,WAAW,CAAC,CAAC,EAAEH,WAAW,CAAC,EAAED,YAAY,CAAC,CAAC,GAC9C,CAAC,EAAEC,WAAW,CAAC,CAAC,EAAED,YAAY,CAAC,CAAC,AAAC;IAEvC,OAAO;QACLA,YAAY;QACZM,cAAc;QACdL,WAAW;QACXG,WAAW;KACZ,CAAC;AACJ,CAAC"}