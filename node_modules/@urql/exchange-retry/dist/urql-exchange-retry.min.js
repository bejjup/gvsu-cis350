Object.defineProperty(exports,"__esModule",{value:!0});var r=require("wonka"),e=require("@urql/core");exports.retryExchange=t=>{var{retryIf:a,retryWith:n}=t,o=t.initialDelayMs||1e3,u=t.maxDelayMs||15e3,l=t.maxNumberAttempts||2,i=null==t.randomDelay||!!t.randomDelay;return({forward:t})=>y=>{var{source:d,next:c}=r.makeSubject(),m=r.mergeMap((t=>{var a=t.context.retry||{count:0,delay:null},n=++a.count,l=a.delay||o,d=Math.random()+1.5;i?l*d<u?l*=d:l=u:l=Math.min(n*o,u),a.delay=l;var c=r.filter((r=>("query"===r.kind||"teardown"===r.kind)&&r.key===t.key))(y);return r.takeUntil(c)(r.debounce((()=>l))(r.fromValue(e.makeOperation(t.kind,t,{...t.context,retry:a}))))}))(d);return r.filter((r=>{var e=r.operation.context.retry;if(!r.error||!(a?a(r.error,r.operation):n||r.error.networkError))return e&&(e.count=0,e.delay=null),!0;if(!((e&&e.count||0)>=l-1)){var t=n?n(r.error,r.operation):r.operation;return!t||(c(t),!1)}return!0}))(t(r.merge([y,m])))}};
//# sourceMappingURL=urql-exchange-retry.min.js.map
